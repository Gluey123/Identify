#!/bin/bash

# Update the system and install dependencies
sudo apt update
sudo apt upgrade -y
sudo apt install -y python3 python3-venv python3-dev libssl-dev libffi-dev build-essential git

# Create a directory for Cowrie
mkdir -p ~/cowrie
cd ~/cowrie

# Clone the Cowrie repository
git clone https://github.com/cowrie/cowrie

# Change to the Cowrie directory
cd cowrie

# Set up a virtual environment
python3 -m venv cowrie-env
source cowrie-env/bin/activate

# Install Cowrie dependencies
pip install --upgrade pip
pip install -r requirements.txt

# Copy the template configuration files to active configuration files
cp etc/cowrie.cfg.dist etc/cowrie.cfg
cp etc/userdb.example etc/userdb.txt

# Optional: Set Cowrie to listen on port 22 (requires root or non-root binding setup)
# You can change this to another port if you don't want it to be on 22
sed -i 's/#listen_endpoints = tcp\:22:interface=0.0.0.0/listen_endpoints = tcp\:22:interface=0.0.0.0/g' etc/cowrie.cfg

# Start Cowrie
bin/cowrie start

# Output success message
echo "Cowrie SSH Honeypot has been installed and started on port 22!"
